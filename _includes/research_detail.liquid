{% assign track = site.data.lab_projects.tracks | where: 'id', page.research_id | first %}

{% if track %}
  <section class="research-detail-hero">
    <a class="research-back-link" href="{{ '/research/' | relative_url }}">‚Üê Back to Research</a>
    <div class="research-detail-hero-grid">
      <div>
        <h2>{{ track.title }}</h2>
        <p>{{ track.summary }}</p>
      </div>
    </div>
  </section>

  <section class="research-detail-section">
    <h3>Research Overview</h3>
    {% if track.overview %}
      <p class="research-overview-paragraph">{{ track.overview }}</p>
    {% else %}
      <p class="research-overview-paragraph">{{ track.objective | join: ' ' }}</p>
    {% endif %}
  </section>

  <section class="research-detail-section">
    <h3>Research Details</h3>
    {% if track.detail_paragraph %}
      <p class="research-overview-paragraph">{{ track.detail_paragraph }}</p>
    {% elsif track.subprojects and track.subprojects.size > 0 %}
      <p class="research-overview-paragraph">
        Current efforts in this area include
        {% for project in track.subprojects %}
          {% capture project_text %}{{ project.title }}{% if project.details %}: {{ project.details | strip }}{% endif %}{% endcapture %}
          {% if forloop.first %}
            {{ project_text }}
          {% elsif forloop.last %}
            {% if forloop.index == 2 %} and {% else %}, and {% endif -%}
            {{- project_text }}
          {% else %}
            , {{ project_text }}
          {% endif %}
        {% endfor -%}
        .
      </p>
    {% else %}
      <p class="research-overview-paragraph">Detailed narrative content for this research area will be added soon.</p>
    {% endif %}
  </section>
{% else %}
  <p>Research theme details are currently unavailable.</p>
{% endif %}
